<!DOCTYPE html>
<html>
  <head>
    <link href='/flex/assets/global-9916d5b8228587acf80f3b6895466abf.css' rel='stylesheet' type='text/css' />
<script src='/flex/assets/global-a63e4d3d89edd2025dec6b2451238b9e.js' type='text/javascript'></script>

    <title>
      FlexDoc - flex-models - ActiveModel Integration
    </title>
    <script type="text/javascript">
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      
      ga('create', 'UA-42574355-2', 'ddnexus.github.io');
      ga('send', 'pageview');
    </script>
  </head>
  <body>
    <div id="page-nav" class="nocontent">
      <ul id="nav-menu" class="menu_h_list"><li><a href="#" class="isLabel">Flex Project</a><ul><li><a href="/flex/doc/1-Flex-Project/1-Overview.html">Project Overview</a></li><li><a href="/flex/doc/1-Flex-Project/2-Usage-Overview.html">Usage Overview</a></li><li><a href="/flex/doc/1-Flex-Project/3-Configuration.html">Configuration</a></li><li><a href="/flex/doc/1-Flex-Project/4-Rake-Tasks.html">Rake Tasks</a></li></ul></li><li><a href="#" class="isLabel">flex</a><ul><li><a href="/flex/doc/2-flex/1-Overview.html">Overview</a></li><li><a href="/flex/doc/2-flex/2-API-Methods.html">API Methods</a></li><li><a href="#" class="isLabel">Templating</a><div class="arrow right"></div><ul><li><a href="/flex/doc/2-flex/3-Templating/1-Templates.html">Templates</a></li><li><a href="/flex/doc/2-flex/3-Templating/2-Sources.html">Template Sources</a></li><li><a href="/flex/doc/2-flex/3-Templating/3-Tags.html">Tags</a></li><li><a href="/flex/doc/2-flex/3-Templating/4-Variables.html">Variables</a></li><li><a href="/flex/doc/2-flex/3-Templating/5-Interpolation.html">Interpolation</a></li><li><a href="/flex/doc/2-flex/3-Templating/6-Partials.html">Partial Templates</a></li></ul></li><li><a href="/flex/doc/2-flex/4-Result-Extenders.html">Result Extenders</a></li><li><a href="/flex/doc/2-flex/5-Self-Documentation.html">Self Documentation</a></li><li><a href="/flex/doc/2-flex/6-Utility-Methods.html">Utility Methods</a></li></ul></li><li><a href="#" class="isLabel">flex-scopes</a><ul><li><a href="/flex/doc/3-flex-scopes/1-Overview.html">Overview</a></li><li><a href="/flex/doc/3-flex-scopes/2-Scopes.html">Scopes</a></li></ul></li><li><a href="#" class="isLabel">flex-models</a><ul><li><a href="/flex/doc/4-flex-models/1-Overview.html">Overview</a></li><li><a href="/flex/doc/4-flex-models/2-ActiveRecord-And-Mongoid-Integration.html">ActiveRecord And Mongoid Integration</a></li><li><a href="/flex/doc/4-flex-models/3-ActiveModel-Integration.html">ActiveModel Integration</a></li><li><a href="#" class="isLabel">Modules</a><div class="arrow right"></div><ul><li><a href="/flex/doc/4-flex-models/4-Modules/1-Flex::ModelSyncer.html">Flex::ModelSyncer</a></li><li><a href="/flex/doc/4-flex-models/4-Modules/2-Flex::ModelIndexer.html">Flex::ModelIndexer</a></li><li><a href="/flex/doc/4-flex-models/4-Modules/3-Flex::ActiveModel.html">Flex::ActiveModel</a></li></ul></li><li><a href="/flex/doc/4-flex-models/5-Result-Extenders.html">Result Extenders</a></li></ul></li><li><a href="#" class="isLabel">flex-rails</a><ul><li><a href="/flex/doc/5-flex-rails/1-overview.html">Overview</a></li><li><a href="/flex/doc/5-flex-rails/2-Result-Extenders.html">Result Extenders</a></li></ul></li><li><a href="#" class="isLabel">flex-admin</a><ul><li><a href="/flex/doc/6-flex-admin/1-Binary.html">Binary</a></li><li><a href="/flex/doc/6-flex-admin/2-Live-Reindex.html">Live Reindex</a></li></ul></li><li><a href="#" class="isLabel">Tutorials</a><ul><li><a href="/flex/doc/7-Tutorials/1-Flex-vs-Tire.html">Why you should use Flex rather than Tire</a></li><li><a href="/flex/doc/7-Tutorials/2-Migrate-from-0.x.html">How to migrate from flex 0.x</a></li><li><a href="/flex/doc/7-Tutorials/3-Index-and-Search-your-Models.html">Index and Search your Models</a></li><li><a href="/flex/doc/7-Tutorials/4-Index-and-Search-External-Data.html">Index and Search External Data</a></li></ul></li></ul>
      <div id="google-search">
        <script type="text/javascript">
          (function() {
            var cx = '001168365143071728136:m_m7r3q0dhs';
            var gcse = document.createElement('script');
            gcse.type = 'text/javascript';
            gcse.async = true;
            gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
                '//www.google.com/cse/cse.js?cx=' + cx;
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(gcse, s);
          })();
        </script>
        <gcse:search>&nbsp;</gcse:search>
      </div>
    </div>
    <div id="page-toc"></div>
    <div id="content">
      <a id="badge" href="https://badge.fury.io/rb/flex-models"><img src="https://badge.fury.io/rb/flex-models.png" /></a>
      <div class="breadcrumb nocontent">
        <span><a href="/flex/doc">FlexDoc</a></span> &gt; <span><a href="/flex/doc/4-flex-models">flex-models</a></span> &gt; <span>ActiveModel Integration</span>
      </div>
      <h1 id='activemodel_integration'>ActiveModel Integration</h1>

<p>When you want a familiar way to populate and search your index without even need to know elasticsearch or when the data you have to index is external to your app (for example if you crawl a site and want to build a searchable index out of it), you can just manage the index like you were managing any active model, still keeping the searching capability of <code>Flex::Scopes</code> and/or <code>Flex::Templates</code>.</p>

<blockquote>
<p><strong>Notice</strong>: The result returned by querying elasticsearch with a <code>Flex::ActiveModel</code> model, return always regular instance of your class, not the original elasticsearch result structure. However you can always get the raw result by just calling <code>raw_result</code> on the array collection or any model instance.</p>
</blockquote>

<p>The key concept is that you create a model per (elasticsearch) <code>type</code>, similarly to what you would do with a DB: a model per table/collection. You do so by including <code>Flex::ActiveModel</code> which also includes <code>Flex::ModelIndexer</code>, so you will have all the <code>flex.*</code> methods available both at the class level and at the instance level (see <a href='/flex/doc/4-flex-models/4-Modules/2-Flex::ModelIndexer.html'>Flex::ModelIndexer</a>).</p>

<p>Then you declare the model attributes names, and optionally their default and typecasting. You can eventually set also the elasticsearch mapping properties for each attribute that may need it, and you can use it as any other model. For example:</p>
<div class='highlight'><pre><code class='ruby'><span class='k'>class</span> <span class='nc'>Product</span>
  <span class='kp'>include</span> <span class='ss'>Flex</span><span class='p'>:</span><span class='ss'>:ActiveModel</span>

  <span class='c1'># if we omit the next line, the elasticsearch type would have been &#39;product&#39; by default</span>
  <span class='n'>flex</span><span class='o'>.</span><span class='n'>type</span> <span class='o'>=</span> <span class='s1'>&#39;goods&#39;</span>

  <span class='n'>attribute</span> <span class='ss'>:name</span>
  <span class='c1'># optional elasticsearch properties mapping</span>
  <span class='n'>attribute</span> <span class='ss'>:price</span><span class='p'>,</span> <span class='ss'>:properties</span> <span class='o'>=&gt;</span> <span class='p'>{</span><span class='s1'>&#39;type&#39;</span> <span class='o'>=&gt;</span> <span class='s1'>&#39;float&#39;</span><span class='p'>},</span> <span class='ss'>:default</span> <span class='o'>=&gt;</span> <span class='mi'>0</span>

  <span class='c1'># :analyzed =&gt; false is a shortcut to :properties =&gt; { &#39;type&#39; =&gt; &#39;string&#39;, &#39;index&#39; =&gt; &#39;not_analyzed&#39; }</span>
  <span class='n'>attribute</span> <span class='ss'>:color</span><span class='p'>,</span> <span class='ss'>:analyzed</span> <span class='o'>=&gt;</span> <span class='kp'>false</span>

  <span class='c1'># this adds a :created_at and :updated_at attributes</span>
  <span class='n'>attribute_timestamps</span>

  <span class='c1'># standard validation</span>
  <span class='n'>validate</span> <span class='ss'>:name</span><span class='p'>,</span> <span class='ss'>:presence</span> <span class='o'>=&gt;</span> <span class='kp'>true</span>

  <span class='c1'># standard callback</span>
  <span class='n'>before_create</span> <span class='p'>{</span> <span class='nb'>self</span><span class='o'>.</span><span class='n'>name</span> <span class='o'>=</span> <span class='nb'>name</span><span class='o'>.</span><span class='n'>titleize</span> <span class='p'>}</span>

  <span class='c1'># named scope</span>
  <span class='n'>scope</span> <span class='ss'>:red</span><span class='p'>,</span> <span class='n'>term</span><span class='p'>(</span><span class='ss'>:color</span> <span class='o'>=&gt;</span> <span class='s1'>&#39;red&#39;</span><span class='p'>)</span>

<span class='k'>end</span>

<span class='c1'># indexes the data in elasticsearch</span>
<span class='n'>product</span> <span class='o'>=</span> <span class='no'>Product</span><span class='o'>.</span><span class='n'>new</span> <span class='ss'>:name</span>  <span class='o'>=&gt;</span> <span class='s1'>&#39;my_name&#39;</span><span class='p'>,</span>
                      <span class='ss'>:color</span> <span class='o'>=&gt;</span> <span class='s1'>&#39;blue&#39;</span><span class='p'>,</span>
                      <span class='ss'>:price</span> <span class='o'>=&gt;</span> <span class='mi'>9</span><span class='o'>.</span><span class='mi'>99</span>

<span class='n'>product</span><span class='o'>.</span><span class='n'>save</span> <span class='k'>if</span> <span class='n'>product</span><span class='o'>.</span><span class='n'>valid?</span>

<span class='n'>red_products</span> <span class='o'>=</span> <span class='no'>Product</span><span class='o'>.</span><span class='n'>red</span><span class='o'>.</span><span class='n'>all</span>
<span class='n'>product</span> <span class='o'>=</span> <span class='no'>Product</span><span class='o'>.</span><span class='n'>find</span><span class='p'>(</span><span class='s1'>&#39;a09rf&#39;</span><span class='p'>)</span>
<span class='n'>total</span>   <span class='o'>=</span> <span class='no'>Product</span><span class='o'>.</span><span class='n'>count</span>
</code></pre></div>
<h2 id='capabilities'>Capabilities</h2>

<p>By including <code>Flex::ActiveModel</code> your model gets the following capabilities:</p>

<h3 id='validation'>Validation</h3>

<p>Validation is provided verbatim by <code>ActiveModel</code> (see <a href='https://github.com/rails/rails/tree/master/activemodel'>activemodel</a>) so you an use all its standard validation methods.</p>

<h3 id='callbacks'>Callbacks</h3>

<p><code>Flex::ActiveModel</code> provides the <code>create</code>, <code>update</code>, <code>save</code> and <code>destroy</code> callbacks backed by <code>ActiveModel</code>, so you can use them as usual with the <code>before_*</code> and <code>after_*</code> prefixes.</p>

<h3 id='attributes'>Attributes</h3>

<p>By including <code>Flex::ActiveModel</code> you include also the <code>ActiveAttr::Model</code>. It provides a lot of useful goodies, like attribute declarations with defaults and typecasting (see <a href='https://github.com/cgriego/active_attr'>active_attr</a>). Besides, flex extends it with a few features (see <a href='/flex/doc/4-flex-models/4-Modules/3-Flex::ActiveModel.html#class_methods'>Class Methods</a>)</p>

<h3 id='versioning_and_optimistic_lock_updating'>Versioning and optimistic lock updating</h3>

<p><code>Flex::ActiveModel</code> adds the versioning to your models (see <a href='http://www.elasticsearch.org/blog/2011/02/08/versioning.html'>elasticsearch Versioning</a>, so your model has always a <code>_version</code> attribute. Besides, it implements the lock updating throught the method <code>lock_update</code> (see <a href='/flex/doc/4-flex-models/4-Modules/3-Flex::ActiveModel.html#safe_update'>Safe Update</a>).</p>

<h3 id='finders_scopes_and_templates'>Finders, Scopes and Templates</h3>

<p><code>Flex::ActiveModel</code> includes also the <code>Flex::Scopes</code> by default, so you have all the cool finders and chainable scopes ready to use in your model (see <a href='/flex/doc/3-flex-scopes'>flex-scopes</a>)</p>

<p>Besides, if you need more power to easily write complex queries, you can include the <code>Flex::Templates</code> module and use it as usual (see <a href='/flex/doc/2-flex/3-Templating'>Templating</a>)</p>

<h2 id='methods'>Methods</h2>

<p>(see <a href='/flex/doc/4-flex-models/4-Modules/3-Flex::ActiveModel.html'>Flex::ActiveModel</a>, <a href='/flex/doc/4-flex-models/4-Modules/2-Flex::ModelIndexer.html'>Flex::ModelIndexer</a> and <a href='/flex/doc/4-flex-models/4-Modules/1-Flex::ModelSyncer.html'>Flex::ModelSyncer</a>)</p><br />
      <div class="breadcrumb nocontent">
        <span><a href="/flex/doc">FlexDoc</a></span> &gt; <span><a href="/flex/doc/4-flex-models">flex-models</a></span> &gt; <span>ActiveModel Integration</span>
      </div>
    </div>
    <div id="footer" class="nocontent">
      Copyright &copy; 2012-2013 by <a href="mailto://dd.nexus@gmail.com">Domizio Demichelis</a> &mdash; Sponsored by <a href="http://www.escalatemedia.com">Escalate Media</a> and <a href="http://www.barquin.com">Barquin International</a>
    </div>
  </body>
</html>