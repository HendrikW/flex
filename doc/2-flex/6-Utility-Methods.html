<!DOCTYPE html>
<html>
  <head>
    <link href='/flex/assets/global-9916d5b8228587acf80f3b6895466abf.css' rel='stylesheet' type='text/css' />
<script src='/flex/assets/global-a63e4d3d89edd2025dec6b2451238b9e.js' type='text/javascript'></script>

    <title>
      FlexDoc - flex - Utility Methods
    </title>
    <script type="text/javascript">
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      
      ga('create', 'UA-42574355-2', 'ddnexus.github.io');
      ga('send', 'pageview');
    </script>
  </head>
  <body>
    <div id="page-nav" class="nocontent">
      <ul id="nav-menu" class="menu_h_list"><li><a href="#" class="isLabel">Flex Project</a><ul><li><a href="/flex/doc/1-Flex-Project/1-Overview.html">Project Overview</a></li><li><a href="/flex/doc/1-Flex-Project/2-Usage-Overview.html">Usage Overview</a></li><li><a href="/flex/doc/1-Flex-Project/3-Configuration.html">Configuration</a></li><li><a href="/flex/doc/1-Flex-Project/4-Rake-Tasks.html">Rake Tasks</a></li></ul></li><li><a href="#" class="isLabel">flex</a><ul><li><a href="/flex/doc/2-flex/1-Overview.html">Overview</a></li><li><a href="/flex/doc/2-flex/2-API-Methods.html">API Methods</a></li><li><a href="#" class="isLabel">Templating</a><div class="arrow right"></div><ul><li><a href="/flex/doc/2-flex/3-Templating/1-Templates.html">Templates</a></li><li><a href="/flex/doc/2-flex/3-Templating/2-Sources.html">Template Sources</a></li><li><a href="/flex/doc/2-flex/3-Templating/3-Tags.html">Tags</a></li><li><a href="/flex/doc/2-flex/3-Templating/4-Variables.html">Variables</a></li><li><a href="/flex/doc/2-flex/3-Templating/5-Interpolation.html">Interpolation</a></li><li><a href="/flex/doc/2-flex/3-Templating/6-Partials.html">Partial Templates</a></li></ul></li><li><a href="/flex/doc/2-flex/4-Result-Extenders.html">Result Extenders</a></li><li><a href="/flex/doc/2-flex/5-Self-Documentation.html">Self Documentation</a></li><li><a href="/flex/doc/2-flex/6-Utility-Methods.html">Utility Methods</a></li></ul></li><li><a href="#" class="isLabel">flex-scopes</a><ul><li><a href="/flex/doc/3-flex-scopes/1-Overview.html">Overview</a></li><li><a href="/flex/doc/3-flex-scopes/2-Scopes.html">Scopes</a></li></ul></li><li><a href="#" class="isLabel">flex-models</a><ul><li><a href="/flex/doc/4-flex-models/1-Overview.html">Overview</a></li><li><a href="/flex/doc/4-flex-models/2-ActiveRecord-And-Mongoid-Integration.html">ActiveRecord And Mongoid Integration</a></li><li><a href="/flex/doc/4-flex-models/3-ActiveModel-Integration.html">ActiveModel Integration</a></li><li><a href="#" class="isLabel">Modules</a><div class="arrow right"></div><ul><li><a href="/flex/doc/4-flex-models/4-Modules/1-Flex::ModelSyncer.html">Flex::ModelSyncer</a></li><li><a href="/flex/doc/4-flex-models/4-Modules/2-Flex::ModelIndexer.html">Flex::ModelIndexer</a></li><li><a href="/flex/doc/4-flex-models/4-Modules/3-Flex::ActiveModel.html">Flex::ActiveModel</a></li></ul></li><li><a href="/flex/doc/4-flex-models/5-Result-Extenders.html">Result Extenders</a></li></ul></li><li><a href="#" class="isLabel">flex-rails</a><ul><li><a href="/flex/doc/5-flex-rails/1-overview.html">Overview</a></li><li><a href="/flex/doc/5-flex-rails/2-Result-Extenders.html">Result Extenders</a></li></ul></li><li><a href="#" class="isLabel">flex-admin</a><ul><li><a href="/flex/doc/6-flex-admin/1-Binary.html">Binary</a></li><li><a href="/flex/doc/6-flex-admin/2-Live-Reindex.html">Live Reindex</a></li></ul></li><li><a href="#" class="isLabel">Tutorials</a><ul><li><a href="/flex/doc/7-Tutorials/1-Flex-vs-Tire.html">Why you should use Flex rather than Tire</a></li><li><a href="/flex/doc/7-Tutorials/2-Migrate-from-0.x.html">How to migrate from flex 0.x</a></li><li><a href="/flex/doc/7-Tutorials/3-Index-and-Search-your-Models.html">Index and Search your Models</a></li><li><a href="/flex/doc/7-Tutorials/4-Index-and-Search-External-Data.html">Index and Search External Data</a></li></ul></li></ul>
      <div id="google-search">
        <script type="text/javascript">
          (function() {
            var cx = '001168365143071728136:m_m7r3q0dhs';
            var gcse = document.createElement('script');
            gcse.type = 'text/javascript';
            gcse.async = true;
            gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
                '//www.google.com/cse/cse.js?cx=' + cx;
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(gcse, s);
          })();
        </script>
        <gcse:search>&nbsp;</gcse:search>
      </div>
    </div>
    <div id="page-toc"></div>
    <div id="content">
      <a id="badge" href="https://badge.fury.io/rb/flex"><img src="https://badge.fury.io/rb/flex.png" /></a>
      <div class="breadcrumb nocontent">
        <span><a href="/flex/doc">FlexDoc</a></span> &gt; <span><a href="/flex/doc/2-flex">flex</a></span> &gt; <span>Utility Methods</span>
      </div>
      <h1 id='utility_methods'>Utility Methods</h1>

<p>Flex defines some utility class methods: a few are useful for bulk management, and a few are mostly useful for quick prototyping and debugging.</p>

<h2 id='curllike_methods'>Curl-like Methods</h2>

<p>You can use the methods <code>HEAD</code>, <code>GET</code>, <code>PUT</code>, <code>POST</code>, <code>DELETE</code> exactly as you would do with curl (also enforced by the unconventional upcase naming).</p>

<p>They accept 3 arguments:</p>

<ul>
<li>path (required): It will be joined with the <code>Flex::Configuration.base_uri</code> (default <code>http:://localhost:9200</code>) to build the url</li>

<li>data (optional): The data structure to send with the request (if needed). It can be a JSON or YAML string or a ruby structure.</li>

<li>variables (optional): the usual variable hash used for interpolation (in case you use tags in the path or in the data)</li>
</ul>

<p>For example:</p>
<div class='highlight'><pre><code class='ruby'><span class='c1'># with JSON</span>
<span class='no'>Flex</span><span class='o'>.</span><span class='n'>GET</span> <span class='s1'>&#39;/_search&#39;</span><span class='p'>,</span> <span class='s1'>&#39;{&quot;query&quot;:{&quot;match_all&quot;:{}}}&#39;</span>

<span class='c1'># same thing with a ruby structure</span>
<span class='no'>Flex</span><span class='o'>.</span><span class='n'>GET</span> <span class='s1'>&#39;/_search&#39;</span><span class='p'>,</span> <span class='p'>{</span><span class='ss'>:query</span> <span class='o'>=&gt;</span> <span class='p'>{</span><span class='ss'>:match_all</span> <span class='o'>=&gt;</span> <span class='p'>{}}}</span>

<span class='c1'># same thing with YAML</span>
<span class='no'>Flex</span><span class='o'>.</span><span class='n'>GET</span> <span class='s1'>&#39;/_search&#39;</span><span class='p'>,</span> <span class='o'>&lt;&lt;-</span><span class='no'>yaml</span>
<span class='sh'>  query:</span>
<span class='sh'>    match_all: {}</span>
<span class='no'>  yaml</span>

<span class='c1'># using also tags and variables (for the sake of it)</span>
<span class='no'>Flex</span><span class='o'>.</span><span class='n'>GET</span> <span class='s1'>&#39;/_search&#39;</span><span class='p'>,</span> <span class='s1'>&#39;{&quot;query&quot;:{&quot;&lt;&lt;a_tag&gt;&gt;&quot;:{}}}&#39;</span><span class='p'>,</span> <span class='ss'>:a_tag</span> <span class='o'>=&gt;</span> <span class='s1'>&#39;match_all&#39;</span>
<span class='no'>Flex</span><span class='o'>.</span><span class='n'>GET</span> <span class='s1'>&#39;/_search&#39;</span><span class='p'>,</span>  <span class='p'>{</span><span class='ss'>:query</span> <span class='o'>=&gt;</span> <span class='p'>{</span><span class='s1'>&#39;&lt;&lt;a_tag&gt;&gt;&#39;</span> <span class='o'>=&gt;</span> <span class='p'>{}}},</span> <span class='ss'>:a_tag</span> <span class='o'>=&gt;</span> <span class='s1'>&#39;match_all&#39;</span>
<span class='no'>Flex</span><span class='o'>.</span><span class='n'>GET</span> <span class='s1'>&#39;/_search&#39;</span><span class='p'>,</span> <span class='o'>&lt;&lt;-</span><span class='no'>yaml</span><span class='p'>,</span> <span class='ss'>:a_tag</span> <span class='o'>=&gt;</span> <span class='s1'>&#39;match_all&#39;</span>
<span class='sh'>query:</span>
<span class='sh'>  &lt;&lt;a_tag&gt;&gt;: {}</span>
<span class='no'>yaml</span>
</code></pre></div>
<h2 id='bulk_support'>Bulk Support</h2>

<p>This methods are mostly used internally by the rake tasks (see <a href='/flex/doc/1-Flex-Project/4-Rake-Tasks.html'>Rake Tasks</a>), but you may want to use them directly.</p>

<h3 id='flexpost_bulk_collection'>Flex.post_bulk_collection</h3>

<p>This method accepts a <code>collection</code> of objects as the first argument and a hash of options. It passes each object in the <code>collection</code> (and the options) to the <code>Flex.build_bulk_string</code> and collects the formatted bulk string and posts it.</p>

<p><strong>Notice</strong>: If you have an already formatted bulk string you should use <code>Flex.post_bulk_string</code> (see <a href='/flex/doc/2-flex/2-API-Methods.html#Flex_post_bulk_string'>Flex.post_bulk_string</a>).</p>

<h3 id='flexbuild_bulk_string'>Flex.build_bulk_string</h3>

<p>Accepts an object as the first argument and a hash of options. The object can be a <code>Hash</code> in the same format of the elasticsearch document results, or a record/document (flex-models instance).</p>

<p>You can pass an <code>:action</code> option that can be <code>&#39;index&#39;</code> (default), <code>&#39;create&#39;</code>, <code>&#39;update&#39;</code> or <code>&#39;delete&#39;</code>. It will return the bulk string understood by the <a href='http://www.elasticsearch.org/guide/reference/api/bulk/'>elasticsearch bulk API</a>, that can be joined with other bulk strings in order to collect the complete bulk string to pass to the <code>Flex.post_bulk_string</code> method.</p>

<h2 id='other_methods'>Other methods</h2>

<h3 id='flexreload'>Flex.reload!</h3>

<p>This method is useful in the console, when you are editing some template source: it reloads all the sources, so you can try the changes without restarting the console.</p>

<h3 id='flexsearch'>Flex.search</h3>

<p>This method allows you to define and use a Search Template (see <a href='/flex/doc/2-flex/3-Templating/1-Templates.html#flex_search_tempaltes'>Flex Search Tempaltes</a>) on the fly. It is very useful in the console or for quick prototyping, but it is not as efficient as a regular Template loaded from source (which gets compiled), so don&#8217;t use it in your production code.</p>

<p>For example:</p>
<div class='highlight'><pre><code class='ruby'><span class='n'>result</span> <span class='o'>=</span> <span class='no'>Flex</span><span class='o'>.</span><span class='n'>search</span> <span class='o'>&lt;&lt;-</span><span class='no'>yaml</span><span class='p'>,</span> <span class='ss'>:index</span> <span class='o'>=&gt;</span> <span class='s1'>&#39;a_non_default_index&#39;</span>
<span class='sh'>           query:</span>
<span class='sh'>             match_all: {}</span>
<span class='no'>         yaml</span>
</code></pre></div>
<p>As the curl-like methods, the data can be a <code>JSON</code> or <code>YAML</code> string or a <code>ruby</code> structure, and you can also pass the optional variable hash as usual.</p>

<h3 id='flexslim_search'>Flex.slim_search</h3>

<p>Same as <code>Flex.search</code> but uses a Slim Search Template (see <a href='/flex/doc/2-flex/3-Templating/1-Templates.html#flex-slim_search_templates'>Flex Slim Search Templates</a>).</p>

<h3 id='flexjson2yaml'>Flex.json2yaml</h3>

<p>Converts a <code>JSON</code> string to a <code>YAML</code> string</p>

<h3 id='flexyaml2json'>Flex.yaml2json</h3>

<p>Converts a <code>YAML</code> string to a <code>JSON</code> string</p>

<h2 id='quasi_api_methods'>Quasi API Methods</h2>

<p>(see <a href='/flex/doc/2-flex/2-API-Methods.html#flex_additions'>Flex Additions</a>)</p><br />
      <div class="breadcrumb nocontent">
        <span><a href="/flex/doc">FlexDoc</a></span> &gt; <span><a href="/flex/doc/2-flex">flex</a></span> &gt; <span>Utility Methods</span>
      </div>
    </div>
    <div id="footer" class="nocontent">
      Copyright &copy; 2012-2013 by <a href="mailto://dd.nexus@gmail.com">Domizio Demichelis</a> &mdash; Sponsored by <a href="http://www.escalatemedia.com">Escalate Media</a> and <a href="http://www.barquin.com">Barquin International</a>
    </div>
  </body>
</html>